<div class="container-fluid">
    <div class="row mt-4 px-4 ">
        <div class="mx-0 px-0" [ngClass] ="{'col-12 col-lg-3' : this.isAdmin, 'col-12 col-lg-4' : !this.isAdmin}">
            <div class="border rounded shadow-sm min-vh-height">
                <div class="col-12 text-center fs-4 py-2 fst-italic border-bottom  shadow-sm mb-1">
                    Informations
                </div>
            </div>
        </div>
        
        <div class="px-lg-4 " [ngClass] ="{'col-12 col-lg-6' : this.isAdmin, 'col-12 col-lg-8' : !this.isAdmin}">
            <div class="border rounded shadow-sm min-vh-height">
                <div class="col-12 text-center fs-4 py-2 fst-italic border-bottom  shadow-sm mb-1">
                    Activités
                </div>
                <div [ngClass]="{'showDay' : dayIsSelect, 'd-none' :!dayIsSelect}">
                    <div class="row hover-day border-bottom px-0 mx-0 pb-2 cursor-pointer" (click)="showCalendar()">
                        <div class="col-3 text-center">
                            <fa-icon class="fs-4 col-12" [icon]="faChevronDown" ></fa-icon> 
                        </div>
                        <div class="col-6 fs-4 fw-bolder justify-content-center d-flex align-items-center ">
                            {{selectedDay}} {{selectedMonth}} {{selectedYear}}
                        </div>
                        <div class="col-3 text-center" >
                            <fa-icon class="fs-4 col-12" [icon]="faChevronDown" ></fa-icon> 
                        </div>
                    </div>
                    <div class="row px-0 mx-0 scrolltable">
                        <div class="col-10 my-3 offset-1 border rounded">

                                <div *ngFor="let activity of listeActiviteParJour.objectCreated; let last = last" class="row" [ngClass]="{'border-bottom': !last}">
                                    <div class="col-2 p-3 d-flex flex-column align-items-center align-self-center bgTypeCreation">
                                        <div class="row">
                                            <div class="col">
                                                 <fa-icon class="fs-5 " [icon]="faClock" ></fa-icon> 
                                                <strong>  {{ activity.dateCreation | date : 'HH:mm'}}</strong>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="col">
                                               {{activity.typeObjet}}
                                           </div>
                                        </div>
                                    </div>
                                    <div class="col-10 bgCreation">
                                        <div class="row ">
                                            <div class="col-6">
                                                {{activity.id}}
                                            </div>
                                            <div class="col-6">
                                                {{activity.libelle}}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                {{
                                                    activity.typeObjet == 'OR' ?
                                                    (activity.etat == 'A' ? 'Actif' 
                                                    : activity.etat == 'R' ? 'Reservé'
                                                    : 'Non défini')
                                                    :
                                                    activity.typeObjet == 'Item'  || activity.typeObjet == 'SI'?
                                                    (activity.etat == 'A' ? 'Actif' 
                                                    : activity.etat == 'EA' ? 'En attente'
                                                    : activity.etat == 'HS' ? 'Hors service'
                                                    : 'Non défini'
                                                    )
                                                    :
                                                    'Non défini'
                                                }}
                                            </div>
                                            <div class="col-6">
                                                {{activity.profilCreation}}
                                            </div>
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class=" input-group">
                                                        <label class="col-4 col-form-label">Description</label>
                                                        <input class="form-control border-0 zindexZero" type="text" [value]="(activity.description.length === 0) ? 'Aucune description' : ((activity.description.length > 1)? activity.description.length + ' descriptions': activity.description.length + ' description' ) "  >
                                                        <button (click)="selectObjectFromActivity(activity.id, activity.dateCreation)" *ngIf="activity.description.length !== 0" class="input-group-text px-2 py-0 fs-4 border-0 bg-white" data-bs-toggle="modal" data-bs-target="#descriptionModal"><fa-icon class=" text-right close" [icon]="faEye"></fa-icon></button>
                                                      </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>

                        </div>
                    </div>
                    
                </div>

                <div class="dayIsSelected" [ngClass]="{'disabledCalendar' : dayIsSelect}">
                    <div class="row mt-2">
                        <div class="col-3 text-center">
                            <button class="btn btn-light" (click)="changeMonth(false)" [ngClass]="{'showArrow' : !dayIsSelect}">
                                <fa-icon class="fs-5 col-12 " [icon]="faArrowLeft" ></fa-icon> 
                            </button>
                        </div>
                        <div class="col-6 fs-4 fw-bolder justify-content-center d-flex align-items-center">
                            {{selectedMonth}} {{selectedYear}}
                        </div>
                        <div class="col-3 text-center" (click)="changeMonth(true)" [ngClass]="{'showArrow' : !dayIsSelect}">
                            <button class="btn btn-light">
                                <fa-icon class="fs-5 col-12" [icon]="faArrowRight" ></fa-icon> 
                            </button>
                        </div>
                        <!-- <div class="col-2 text-center" (click)="today()">
                            <button class="btn btn-primary"> 
                                <fa-icon class="fs-5 col-12" [icon]="faCalendarCheck" ></fa-icon> 
                            </button>
                        </div> -->

                    </div> 
                    <div *ngIf="waitingMonth" class="mt-5 pt-5 spinnerWaiting">
                        <div class="spinner-grow" role="status">
                          <span class="visually-hidden ">Loading...</span>
                        </div>
                        <div class="spinner-grow" role="status">
                          <span class="visually-hidden ">Loading...</span>
                        </div>
                        <div class="spinner-grow" role="status">
                          <span class="visually-hidden ">Loading...</span>
                        </div>
                    </div> 

                    <div *ngIf="!waitingMonth" class="row mt-3">
                        <div class="col">
                            <table  class="table cursor-pointer">
                                <thead>
                                    <tr>
                                    <th scope="col">Lun</th>
                                    <th scope="col">Mar</th>
                                    <th scope="col">Mer</th>
                                    <th scope="col">Jeu</th>
                                    <th scope="col">Ven</th>
                                    <th scope="col">Sam</th>
                                    <th scope="col">Dim</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let week of weekOfCurrentMonth ; let first = first; let last = last; let j = index">
                                        <td class="dixsept" [ngClass]="{'today' : this.currentDay == day && this.currentMonth == selectedMonth && selectedYear == currentYear,
                                                    'disabled' : (day >20 && first) || (day <10 && last) , 'selectedDay' : day === selectedDay, 'border-end' : !lastOfWeek}" *ngFor="let day of week, let i = index, let lastOfWeek = last"
                                                    (click)="selectDay(day, (day >20 && first) || (day <10 && last))"> 
                                            
                                            <div class="row">
                                                <div class="col">
                                                    {{day}} 
                                                </div>
                                            </div>
                                            <div class="row" [ngClass]="{'my-2' : this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountC == -1 &&
                                            this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountM == -1 && 
                                            this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountD == -1}">
                                                <div class="col">
                                                    <span class="badge bg-success mx-1" *ngIf="this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountC != -1">
                                                         {{this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountC > 100 ? '99+' : this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountC}}
                                                    </span>
                                                    <span class="badge bg-warning mx-1" *ngIf="this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountM != -1">
                                                        {{this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountM > 100 ? '99+' : this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountM}} 
                                                    </span>
                                                    <span class="badge bg-danger mx-1" *ngIf="this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountD != -1">
                                                        {{this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountD > 100 ? '99+' : this.calendarAndActivity[(j !== 0 ? (i === 0) ? j *7 : j*7+i : i )][1].CountD}} 
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            
            </div>
        </div>

        
        <div class="col-12 col-lg-3 min-vh-height border rounded shadow-sm scrolltable" [ngClass] ="{'d-none' : !this.isAdmin}">
            <div class="row justify-content-center fs-4 py-2 fst-italic border-bottom shadow-sm mb-1 stickyheader">
                Demande de suppressions
            </div>
            <div >
                <div class="row" *ngIf="this.listeDemandeAdmin.length === 0; else afficheDemandeAdmin">
                    <div class="col my-3 text-center">Aucune demande</div>
                    </div>
                <ng-template #afficheDemandeAdmin>
                    <div class="row border-bottom border-2 " *ngFor="let dmdAdmin of listeDemandeAdmin" >
                        <div class="row my-1">
                            <div class="col-5">
                                <div class="row">
                                    <fa-icon class="fs-5 col-12 text-center " [icon]="faUser" ></fa-icon> 
                                </div>
                                <div class="row text-center">
                                    <span class="col-12  ">{{dmdAdmin.profilCreation}}</span>
                                </div>
                            </div>
                            <div class="col-5">
                                <div class="row">
                                    <fa-icon class="fs-5 col-12 text-center" [icon]="faCalendar" ></fa-icon>
                                </div>
                                <div class="row text-center">
                                    <span class="col-12">{{dmdAdmin.dateCreation| date: 'dd/MM/yyyy HH:mm'}}</span>
                                </div>
                            </div>
                            <div class="col-2 pt-2 pb-1">
                                <button routerLink="/demandeAdmin" [state]="{ id: dmdAdmin.idDemande}" type="button" class="btn btn-light h-100 buttonEditDemande">
                                    <fa-icon class="fs-5 col-12 text-center " [icon]="faRightLong" ></fa-icon> 
                                </button>
                            </div>
                            
                        </div>
                        <div class="row mt-1 mb-3  mx-0">
                            <div class="col-1 align-self-center text-start px-0">
                                <fa-icon class="fs-5 col-12  " [icon]="faComment" ></fa-icon> 
                            </div>
                            <div class="col-11 border border-2 rounded-3 px-2 ">
                                    <span class="col-12  lh-lg">{{dmdAdmin.motif}}</span>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModal" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="descriptionModal">Description(s) de {{this.selectedIdOfObject}}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ul class="list-group">
                <li *ngFor="let desc of this.selectedObjet.description" class="list-group-item">{{desc.lien}}</li>
            </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary"  data-bs-dismiss="modal">Retour</button>
        </div>
      </div>
    </div>
  </div>